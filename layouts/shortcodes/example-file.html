<!--
  This shortcode is intended to render the contents of a sample code file.
  It is a wrapper for the "code-block" shortcode. Calling shortcodes from
  pages directly is not supported in Hugo. 
-->

{{- $exampleLibrarySourcePath :=  $.Page.Site.Params.exampleLibrarySourcePath }}
{{- $exampleLibraryGitHubBaseUrl := $.Page.Site.Params.exampleLibraryGitHubBaseUrl }}

{{ if .IsNamedParams }}
  {{- $folder := print $exampleLibrarySourcePath "/" (.Get "dir") "/" (.Get "filename") }}
  {{ if ne (.Get "githubUrl") $exampleLibraryGitHubBaseUrl}}
    {{ if eq (index (split (.Get "dir") "/") 0) "score" }}
      {{ $updatedDir := delimit (after 3 (split (.Get "dir") "/")) "/" }}
      {{ $updatedFolder := print  "/" $updatedDir "/" (.Get "filename") }}
      {{- partial "content/code-block" ( dict 
        "file" $folder 
        "gitHubUrl" (print 
          (.Get "githubUrl" | default $exampleLibraryGitHubBaseUrl)
          ( strings.TrimPrefix $exampleLibrarySourcePath $updatedFolder ) 
        )
        "currentPage" $.Page
      ) -}}
    {{ end }}
    {{ if eq (index (split (.Get "dir") "/") 0) "patch-templates" }}
      {{ $updatedDir := delimit (after 1 (split (.Get "dir") "/")) "/" }}
      {{ $updatedFolder := print  "/" $updatedDir "/" (.Get "filename") }}
      {{- partial "content/code-block" ( dict 
        "file" $folder 
        "gitHubUrl" (print 
          (.Get "githubUrl" | default $exampleLibraryGitHubBaseUrl)
          ( strings.TrimPrefix $exampleLibrarySourcePath $updatedFolder ) 
        )
        "currentPage" $.Page
      ) -}}
    {{ end }}
    {{ if eq (index (split (.Get "dir") "/") 0) "resource-provisioners" }}
      {{ $updatedDir := delimit (after 2 (split (.Get "dir") "/")) "/" }}
      {{ $updatedFolder := print  "/" $updatedDir "/" (.Get "filename") }}
      {{ if eq (index (split (.Get "dir") "/") 1) "default" }}
        {{- partial "content/code-block" ( dict 
          "file" $folder 
          "gitHubUrl" (.Get "githubUrl" | default $exampleLibraryGitHubBaseUrl)
          "currentPage" $.Page
        ) -}}
      {{ else }}
        {{- partial "content/code-block" ( dict 
          "file" $folder 
          "gitHubUrl" (print 
            (.Get "githubUrl" | default $exampleLibraryGitHubBaseUrl)
            ( strings.TrimPrefix $exampleLibrarySourcePath $updatedFolder ) 
          )
          "currentPage" $.Page
        ) -}}
      {{ end }}
    {{ end }}
  {{ else }}
    {{ $dirSegments := split (.Get "dir") "/" }}
    {{ $filteredSegments := slice }}
    {{ range $dirSegments }}
      {{ if and (ne . "") (ne . "default-provisioners") (ne . "score") }}
        {{ $filteredSegments = $filteredSegments | append . }}
      {{ end }}
    {{ end }}
    {{ $updatedDir := delimit $filteredSegments "/" }}
    {{ $updatedFolder := print  "/" $updatedDir "/" (.Get "filename") }}
    {{- partial "content/code-block" ( dict 
      "file" $folder 
      "gitHubUrl" (print 
        (.Get "githubUrl" | default $exampleLibraryGitHubBaseUrl)
        ( strings.TrimPrefix $exampleLibrarySourcePath $updatedFolder ) 
      )
      "currentPage" $.Page
    ) -}}
  {{ end }}
{{ else }}
  {{- $fileName := .Get 0 }}
  {{- partial "content/code-block" ( dict 
    "file" (print $exampleLibrarySourcePath $fileName )
    "gitHubUrl" (print $exampleLibraryGitHubBaseUrl ( strings.TrimPrefix $exampleLibrarySourcePath $fileName ) )
    "currentPage" $.Page
    ) }}
{{ end }}

